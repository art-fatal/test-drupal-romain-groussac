{#
/**
 * @file
 * Template for SEO Dashboard.
 *
 * Available variables:
 * - content: Array of content items with SEO data.
 * - pagination: Array of pagination data.
 * - stats: Array of dashboard statistics.
 */
#}

<div class="seo-dashboard">
  {# Statistiques #}
  <div class="seo-dashboard__stats">
    <div class="stat-card">
      <div class="stat-card__icon">
        <i class="fas fa-file-lines"></i>
      </div>
      <div class="stat-card__content">
        <div class="stat-card__value">{{ stats.total_published }}</div>
        <div class="stat-card__label">Contenus publiés</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-card__icon">
        <i class="fas fa-pen-to-square"></i>
      </div>
      <div class="stat-card__content">
        <div class="stat-card__value">{{ stats.total_drafts }}</div>
        <div class="stat-card__label">Brouillons</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-card__icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="stat-card__content">
        <div class="stat-card__value">{{ stats.average_seo_score }}/100</div>
        <div class="stat-card__label">Score SEO moyen</div>
      </div>
    </div>

    <button class="button btn" id="clear-cache-btn" style="height: 50px; width: 100%;">
      <i class="fas fa-trash"></i>
      Purger le cache
    </button>
  </div>

  {# Liste des contenus #}
  <div class="seo-dashboard__content">
    <div class="content-header">
      <h2><i class="fas fa-list"></i> Liste des contenus</h2>
      <div class="content-filters">
        <div class="search-wrapper">
          <i class="fas fa-search search-icon"></i>
          <input type="text" id="content-search" placeholder="Rechercher un contenu..." class="form-control">
        </div>
        <select id="status-filter" class="form-control">
          <option value="">Tous les statuts</option>
          <option value="Publié">Publié</option>
          <option value="Brouillon">Brouillon</option>
        </select>
        <select id="items-per-page" class="form-control">
          <option value="5" {% if pagination.items_per_page == 5 %}selected{% endif %}>5 par page</option>
          <option value="20" {% if pagination.items_per_page == 20 %}selected{% endif %}>20 par page</option>
          <option value="50" {% if pagination.items_per_page == 50 %}selected{% endif %}>50 par page</option>
          <option value="100" {% if pagination.items_per_page == 100 %}selected{% endif %}>100 par page</option>
        </select>
      </div>
    </div>

    {# Informations de pagination #}
    {% if pagination.total_items > 0 %}
      <div class="pagination-info">
        <span class="pagination-info__text">
          Affichage de {{ pagination.start_item }} à {{ pagination.end_item }} sur {{ pagination.total_items }} contenus
        </span>
      </div>
    {% endif %}

    <div class="content-table-wrapper">
      <table class="content-table">
        <thead>
          <tr>
            <th>Titre</th>
            <th>Type</th>
            <th>Auteur</th>
            <th>Date de création</th>
            <th>Dernière modification</th>
            <th>Statut</th>
            <th>Score SEO (/100)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for item in content %}
            <tr class="content-row" data-status="{{ item.status }}" data-title="{{ item.title|lower }}">
              <td>
                <a href="{{ item.url }}" target="_blank" class="content-title">
                  {{ item.title }}
                </a>
              </td>
              <td>
                <span class="content-type">{{ item.type }}</span>
              </td>
              <td>{{ item.author }}</td>
              <td>{{ item.created|date('d/m/Y H:i') }}</td>
              <td>{{ item.changed|date('d/m/Y H:i') }}</td>
              <td>
                <span class="status-badge status-badge--{{ item.status|lower }} {% if item.status == 'Publié' %}status-published{% else %}status-draft{% endif %}">
                  {{ item.status }}
                </span>
              </td>
              <td>
                <div class="seo-score">
                  <span class="seo-score__value content-type">{{ item.seo_score }}</span>
                </div>
              </td>
              <td>
                <div class="content-actions">
                  <a href="{{ item.url }}" class="btn btn--small" title="Voir">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a href="/node/{{ item.id }}/edit" class="btn btn--small" title="Modifier">
                    <i class="fas fa-pen-to-square"></i>
                  </a>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {# Pagination #}
    <!-- Debug: pagination variable exists: {{ pagination is defined ? 'YES' : 'NO' }} -->
    <!-- Debug: pagination is null: {{ pagination is null ? 'YES' : 'NO' }} -->
    <!-- Debug: pagination is empty: {{ pagination is empty ? 'YES' : 'NO' }} -->
    <!-- Debug: pagination type: {{ pagination|json_encode }} -->
    {% if pagination is defined and pagination is not null and pagination.total_pages > 0 %}
      <div class="pagination">
        <div class="pagination__info">
          <span>Page {{ pagination.current_page }} sur {{ pagination.total_pages }}</span>
        </div>

        <div class="pagination__controls">
          {# Bouton première page #}
          {% if pagination.has_previous %}
            <a href="{{ pagination.first_url }}" class="pagination__btn pagination__btn--first" title="Première page">
              <i class="fas fa-angle-double-left"></i>
            </a>
          {% endif %}

          {# Bouton page précédente #}
          {% if pagination.has_previous %}
            <a href="{{ pagination.previous_url }}" class="pagination__btn pagination__btn--prev" title="Page précédente">
              <i class="fas fa-angle-left"></i>
            </a>
          {% endif %}

          {# Numéros de pages #}
          <div class="pagination__pages">
            {% for page in pagination.pages %}
              {% if page.current %}
                <span class="pagination__page pagination__page--current">{{ page.number }}</span>
              {% else %}
                <a href="{{ page.url }}" class="pagination__page">{{ page.number }}</a>
              {% endif %}
            {% endfor %}
          </div>

          {# Bouton page suivante #}
          {% if pagination.has_next %}
            <a href="{{ pagination.next_url }}" class="pagination__btn pagination__btn--next" title="Page suivante">
              <i class="fas fa-angle-right"></i>
            </a>
          {% endif %}

          {# Bouton dernière page #}
          {% if pagination.has_next %}
            <a href="{{ pagination.last_url }}" class="pagination__btn pagination__btn--last" title="Dernière page">
              <i class="fas fa-angle-double-right"></i>
            </a>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>

  {# Notifications #}
  <div id="notifications" class="notifications"></div>
</div>
